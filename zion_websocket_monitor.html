<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ZION WebSocket Monitor</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #0f0f23 0%, #1a1a2e 100%);
            color: #ffffff;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        h1 {
            text-align: center;
            color: #00ff88;
            margin-bottom: 30px;
            text-shadow: 0 0 20px rgba(0, 255, 136, 0.5);
        }
        .status {
            text-align: center;
            margin-bottom: 20px;
            padding: 10px;
            border-radius: 5px;
            font-weight: bold;
        }
        .status.connected {
            background: rgba(0, 255, 136, 0.2);
            border: 1px solid #00ff88;
        }
        .status.disconnected {
            background: rgba(255, 136, 0, 0.2);
            border: 1px solid #ff8800;
        }
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .metric-card {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            padding: 20px;
            backdrop-filter: blur(10px);
        }
        .metric-card h3 {
            margin: 0 0 15px 0;
            color: #00ff88;
            border-bottom: 2px solid #00ff88;
            padding-bottom: 5px;
        }
        .metric-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            padding: 5px 0;
        }
        .metric-label {
            color: #cccccc;
        }
        .metric-value {
            color: #ffffff;
            font-weight: bold;
            font-family: 'Courier New', monospace;
        }
        .controls {
            text-align: center;
            margin-bottom: 20px;
        }
        button {
            background: linear-gradient(45deg, #00ff88, #00ccff);
            border: none;
            color: #000;
            padding: 10px 20px;
            margin: 0 10px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 255, 136, 0.4);
        }
        .log {
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 5px;
            padding: 15px;
            height: 200px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 12px;
        }
        .log-entry {
            margin-bottom: 5px;
        }
        .log-time {
            color: #888;
        }
        .log-type {
            color: #00ff88;
        }
        .rize-indicator {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: radial-gradient(circle, #ff0088, #8800ff);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 14px;
            text-align: center;
            box-shadow: 0 0 30px rgba(255, 0, 136, 0.5);
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
    </style>
</head>
<body>
    <div class="rize-indicator" id="rizeIndicator">
        RIZE<br/>Energy<br/><span id="rizeLevel">0.00</span>
    </div>

    <div class="container">
        <h1>üåü ZION 2.8.2 Nebula - Real-Time Monitor</h1>

        <div class="status disconnected" id="connectionStatus">
            üîå Connecting to WebSocket...
        </div>

        <div class="controls">
            <button onclick="connect()">Connect</button>
            <button onclick="disconnect()">Disconnect</button>
            <button onclick="subscribeAll()">Subscribe All</button>
            <button onclick="clearLog()">Clear Log</button>
        </div>

        <div class="metrics-grid">
            <div class="metric-card">
                <h3>‚õèÔ∏è Mining Metrics</h3>
                <div class="metric-item">
                    <span class="metric-label">Hashrate:</span>
                    <span class="metric-value" id="hashrate">0.00 H/s</span>
                </div>
                <div class="metric-item">
                    <span class="metric-label">Shares:</span>
                    <span class="metric-value" id="shares">0/0/0 (S/A/R)</span>
                </div>
                <div class="metric-item">
                    <span class="metric-label">Blocks Found:</span>
                    <span class="metric-value" id="blocksFound">0</span>
                </div>
                <div class="metric-item">
                    <span class="metric-label">Temperature:</span>
                    <span class="metric-value" id="temperature">0.0¬∞C</span>
                </div>
                <div class="metric-item">
                    <span class="metric-label">Power:</span>
                    <span class="metric-value" id="power">0.0W</span>
                </div>
                <div class="metric-item">
                    <span class="metric-label">Efficiency:</span>
                    <span class="metric-value" id="efficiency">0.0%</span>
                </div>
            </div>

            <div class="metric-card">
                <h3>ü§ñ AI Metrics</h3>
                <div class="metric-item">
                    <span class="metric-label">Active Models:</span>
                    <span class="metric-value" id="activeModels">0</span>
                </div>
                <div class="metric-item">
                    <span class="metric-label">Predictions:</span>
                    <span class="metric-value" id="predictions">0</span>
                </div>
                <div class="metric-item">
                    <span class="metric-label">Optimization Cycles:</span>
                    <span class="metric-value" id="optimizationCycles">0</span>
                </div>
                <div class="metric-item">
                    <span class="metric-label">Consciousness Level:</span>
                    <span class="metric-value" id="consciousnessLevel">0.00</span>
                </div>
                <div class="metric-item">
                    <span class="metric-label">RIZE Energy:</span>
                    <span class="metric-value" id="rizeEnergy">0.00</span>
                </div>
            </div>

            <div class="metric-card">
                <h3>üíª System Metrics</h3>
                <div class="metric-item">
                    <span class="metric-label">CPU Usage:</span>
                    <span class="metric-value" id="cpuUsage">0.0%</span>
                </div>
                <div class="metric-item">
                    <span class="metric-label">Memory Usage:</span>
                    <span class="metric-value" id="memoryUsage">0.0%</span>
                </div>
                <div class="metric-item">
                    <span class="metric-label">Network RX:</span>
                    <span class="metric-value" id="networkRx">0 B/s</span>
                </div>
                <div class="metric-item">
                    <span class="metric-label">Network TX:</span>
                    <span class="metric-value" id="networkTx">0 B/s</span>
                </div>
                <div class="metric-item">
                    <span class="metric-label">Disk Usage:</span>
                    <span class="metric-value" id="diskUsage">0.0%</span>
                </div>
                <div class="metric-item">
                    <span class="metric-label">Uptime:</span>
                    <span class="metric-value" id="uptime">0s</span>
                </div>
            </div>
        </div>

        <div class="metric-card">
            <h3>üìã Event Log</h3>
            <div class="log" id="eventLog"></div>
        </div>
    </div>

    <script>
        let websocket = null;
        let reconnectInterval = null;
        const RECONNECT_DELAY = 5000;

        function connect() {
            if (websocket && websocket.readyState === WebSocket.OPEN) {
                log('Already connected', 'info');
                return;
            }

            const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
            const wsUrl = `${protocol}//${window.location.host}:8080`;

            log(`Connecting to ${wsUrl}...`, 'info');

            try {
                websocket = new WebSocket(wsUrl);

                websocket.onopen = function(event) {
                    log('WebSocket connected', 'success');
                    updateConnectionStatus(true);
                    clearInterval(reconnectInterval);

                    // Subscribe to all metrics
                    subscribeAll();
                };

                websocket.onmessage = function(event) {
                    try {
                        const data = JSON.parse(event.data);
                        handleMessage(data);
                    } catch (e) {
                        log(`Error parsing message: ${e}`, 'error');
                    }
                };

                websocket.onclose = function(event) {
                    log(`WebSocket disconnected (${event.code})`, 'warning');
                    updateConnectionStatus(false);

                    // Auto-reconnect
                    reconnectInterval = setInterval(() => {
                        log('Attempting to reconnect...', 'info');
                        connect();
                    }, RECONNECT_DELAY);
                };

                websocket.onerror = function(error) {
                    log(`WebSocket error: ${error}`, 'error');
                };

            } catch (e) {
                log(`Failed to connect: ${e}`, 'error');
            }
        }

        function disconnect() {
            if (websocket) {
                websocket.close();
                websocket = null;
            }
            clearInterval(reconnectInterval);
            updateConnectionStatus(false);
        }

        function subscribeAll() {
            if (websocket && websocket.readyState === WebSocket.OPEN) {
                const subscribeMsg = {
                    type: 'subscribe',
                    channels: ['mining_metrics', 'ai_metrics', 'system_metrics'],
                    timestamp: Date.now() / 1000
                };
                websocket.send(JSON.stringify(subscribeMsg));
                log('Subscribed to all channels', 'info');
            }
        }

        function handleMessage(data) {
            const timestamp = new Date(data.timestamp * 1000).toLocaleTimeString();

            switch (data.type) {
                case 'welcome':
                    log(`Server: ${data.message}`, 'success');
                    break;

                case 'subscribed':
                    log(`Subscribed to: ${data.channels.join(', ')}`, 'info');
                    break;

                case 'pong':
                    log('Ping response received', 'info');
                    break;

                case 'mining_metrics':
                    updateMiningMetrics(data.data);
                    log(`Mining metrics updated at ${timestamp}`, 'data');
                    break;

                case 'ai_metrics':
                    updateAIMetrics(data.data);
                    log(`AI metrics updated at ${timestamp}`, 'data');
                    break;

                case 'system_metrics':
                    updateSystemMetrics(data.data);
                    log(`System metrics updated at ${timestamp}`, 'data');
                    break;

                default:
                    log(`Unknown message type: ${data.type}`, 'warning');
            }
        }

        function updateMiningMetrics(data) {
            document.getElementById('hashrate').textContent = formatHashrate(data.hashrate);
            document.getElementById('shares').textContent = `${data.shares_submitted}/${data.shares_accepted}/${data.shares_rejected}`;
            document.getElementById('blocksFound').textContent = data.blocks_found;
            document.getElementById('temperature').textContent = `${data.temperature}¬∞C`;
            document.getElementById('power').textContent = `${data.power_consumption}W`;
            document.getElementById('efficiency').textContent = `${data.efficiency}%`;
        }

        function updateAIMetrics(data) {
            document.getElementById('activeModels').textContent = data.active_models;
            document.getElementById('predictions').textContent = data.predictions_made;
            document.getElementById('optimizationCycles').textContent = data.optimization_cycles;
            document.getElementById('consciousnessLevel').textContent = data.consciousness_level.toFixed(2);
            document.getElementById('rizeEnergy').textContent = data.rize_energy.toFixed(2);
            document.getElementById('rizeLevel').textContent = data.rize_energy.toFixed(2);
        }

        function updateSystemMetrics(data) {
            document.getElementById('cpuUsage').textContent = `${data.cpu_usage}%`;
            document.getElementById('memoryUsage').textContent = `${data.memory_usage}%`;
            document.getElementById('networkRx').textContent = formatBytes(data.network_rx) + '/s';
            document.getElementById('networkTx').textContent = formatBytes(data.network_tx) + '/s';
            document.getElementById('diskUsage').textContent = `${data.disk_usage}%`;
            document.getElementById('uptime').textContent = formatUptime(data.uptime);
        }

        function updateConnectionStatus(connected) {
            const statusEl = document.getElementById('connectionStatus');
            if (connected) {
                statusEl.textContent = 'üü¢ Connected to ZION WebSocket Server';
                statusEl.className = 'status connected';
            } else {
                statusEl.textContent = 'üî¥ Disconnected from WebSocket Server';
                statusEl.className = 'status disconnected';
            }
        }

        function formatHashrate(hashrate) {
            if (hashrate >= 1e12) return (hashrate / 1e12).toFixed(2) + ' TH/s';
            if (hashrate >= 1e9) return (hashrate / 1e9).toFixed(2) + ' GH/s';
            if (hashrate >= 1e6) return (hashrate / 1e6).toFixed(2) + ' MH/s';
            if (hashrate >= 1e3) return (hashrate / 1e3).toFixed(2) + ' KH/s';
            return hashrate.toFixed(2) + ' H/s';
        }

        function formatBytes(bytes) {
            if (bytes >= 1e9) return (bytes / 1e9).toFixed(2) + ' GB';
            if (bytes >= 1e6) return (bytes / 1e6).toFixed(2) + ' MB';
            if (bytes >= 1e3) return (bytes / 1e3).toFixed(2) + ' KB';
            return bytes + ' B';
        }

        function formatUptime(seconds) {
            const days = Math.floor(seconds / 86400);
            const hours = Math.floor((seconds % 86400) / 3600);
            const mins = Math.floor((seconds % 3600) / 60);
            const secs = Math.floor(seconds % 60);

            if (days > 0) return `${days}d ${hours}h ${mins}m`;
            if (hours > 0) return `${hours}h ${mins}m ${secs}s`;
            if (mins > 0) return `${mins}m ${secs}s`;
            return `${secs}s`;
        }

        function log(message, type = 'info') {
            const logEl = document.getElementById('eventLog');
            const timestamp = new Date().toLocaleTimeString();
            const entry = document.createElement('div');
            entry.className = 'log-entry';

            const timeSpan = document.createElement('span');
            timeSpan.className = 'log-time';
            timeSpan.textContent = `[${timestamp}] `;

            const typeSpan = document.createElement('span');
            typeSpan.className = 'log-type';
            typeSpan.textContent = `[${type.toUpperCase()}] `;

            const messageSpan = document.createElement('span');
            messageSpan.textContent = message;

            entry.appendChild(timeSpan);
            entry.appendChild(typeSpan);
            entry.appendChild(messageSpan);

            logEl.appendChild(entry);
            logEl.scrollTop = logEl.scrollHeight;
        }

        function clearLog() {
            document.getElementById('eventLog').innerHTML = '';
        }

        // Auto-connect on page load
        window.addEventListener('load', () => {
            setTimeout(connect, 1000);
        });

        // Cleanup on page unload
        window.addEventListener('beforeunload', () => {
            disconnect();
        });
    </script>
</body>
</html>